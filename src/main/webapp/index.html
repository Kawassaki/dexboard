<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<title>DexBoard</title>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<link rel="stylesheet" href="css/main.css" type="text/css" />
</head>

<body>
	<h1>Projetos</h1>
	<div id="projetos">Carregando...</div>
</body>

<script>

function mostrar (id){
	$('#content_'+id).toggle('fast');
};

var classes =  ['', 'ms', 's', 'i', 'mi'];
var classes2 = ['', 'mi', 'i', 's', 'ms'];

function tabularObjeto(objeto) {
		var novoProjeto = $('<div class="projeto">');

		var header;
		if (objeto.cpi >= 1) {
			header = 'b';
		}else if (objeto.cpi >= 0.9 && objeto.cpi < 1) {
			header = 'a';
		} else {
			header = 'v';
		}

		var cpi = objeto.cpi+"";

		if (cpi.indexOf(".") != -1) {
			if (cpi.substr(cpi.indexOf(".")+1).length == 1 ) {
				cpi = cpi.substr(cpi.indexOf(".")-1, 1)+','+ cpi.substr(cpi.indexOf(".")+1) +'0';
			} else {
				cpi = cpi.substr(cpi.indexOf(".")-1, 1)+','+ cpi.substr(cpi.indexOf(".")+1) ;
			}
		} else {
			cpi = cpi+",00";
		}

		var fase = objeto.fase;
		fase = fase.substr(0, 1).toUpperCase()+fase.substr(1);

		var divHeader = $('<div class="header '+header+'" onclick="mostrar('+objeto.id+')">').appendTo(novoProjeto);

		var divTitle = $('<div class="title">').appendTo(divHeader);

		var nome = objeto.projeto;

		if (nome.indexOf(':') != -1) {
			nome = nome.replace(':', ' -');
		}

		divTitle.append('<h2>Projeto: '+nome+'</h2>');

		var divAdd = $('<div class="adicionais">').appendTo(divHeader);

		divAdd.append('<span>Fase: '+fase+'</span>');

		var divCPI = $('<div class="cpi">').appendTo(divAdd);
		divCPI.append('CPI <strong>'+ cpi +'</strong>');

		var divContent = $('<div class="content" id="content_'+ objeto.id +'">').appendTo(novoProjeto);

		var divEquipe = $('<div class="contentEquipe">').appendTo(divContent);
		divEquipe.append('<h2>Satisfa&ccedil;&atilde;o da Equipe</h2>');

		if (objeto.satisfacaoEquipe != null) {

			if (objeto.satisfacaoEquipe.resultadoEntregue != null) {

				var satistacao = objeto.satisfacaoEquipe.resultadoEntregue;

				var totalPontos = 0;
				var totalVotos = 0;

				var i = 1;
				for (var sub in satistacao) {
					totalPontos += (satistacao[sub] * i);
					totalVotos += satistacao[sub];
					i++;
				}

				var posicao = Math.round(totalPontos / totalVotos);

				var divResultadoEntregueEquipe = $('<div class="status '+ classes[posicao] +'">').appendTo(divEquipe);
				divResultadoEntregueEquipe.append('Resultado Entregue');
			}

			if ( objeto.satisfacaoEquipe.andamentoDoSprint != null) {

				var satistacao = objeto.satisfacaoEquipe.andamentoDoSprint;

				var totalPontos = 0;
				var totalVotos = 0;

				var i = 1;
				for (var sub in satistacao) {
					totalPontos += (satistacao[sub] * i);
					totalVotos += satistacao[sub];
					i++;
				}

				var posicao = Math.round(totalPontos / totalVotos);

				var divAndamentoDoSprintEquipe = $('<div class="status '+classes[posicao]+'">').appendTo(divEquipe);
				divAndamentoDoSprintEquipe.append('Andamento do Sprint');
			}
		}

		var divQualidade = $('<div class="contentQualidade">').appendTo(divContent);
		divQualidade.append('<h2>Qualidade do Software</h2>');
		divQualidade.append('<span>As m&eacute;tricas abaixo demonstram qu&atilde;o f&aacute;cil o sistema &eacute; para:</span>');


		if (objeto.qualidade != null) {
			var divMinis = $('<div class="minis">').appendTo(divQualidade);

			if (objeto.qualidade.evoluir != null) {
				var divEvoluir = $('<div class="miniStatus '+classes2[objeto.qualidade.evoluir]+'">').appendTo(divMinis);
				divEvoluir.append('Evoluir');
			}

			if (objeto.qualidade.erros != null) {
				var divDetectarErros = $('<div class="miniStatus '+classes2[objeto.qualidade.erros]+'">').appendTo(divMinis);
				divDetectarErros.append('Detectar Erros');
			}

			if (objeto.qualidade.testar != null) {
				var divTestar = $('<div class="miniStatus '+classes2[objeto.qualidade.testar]+'">').appendTo(divMinis);
				divTestar.append('Testar');
			}

			if (objeto.qualidade.aprender != null) {
				var divAprender = $('<div class="miniStatus '+classes2[objeto.qualidade.aprender]+'">').appendTo(divMinis);
				divAprender.append('Aprender');
			}
		}

		var divCliente = $('<div class="contentCliente">').appendTo(divContent);
		divCliente.append('<h2>Satisfa&ccedil;&atilde;o do Cliente</h2>');

		if (objeto.satisfacaoCliente != null) {

			if (objeto.satisfacaoCliente.resultadoEntregue != null) {

				var satistacao = objeto.satisfacaoCliente.resultadoEntregue;

				var totalPontos = 0;
				var totalVotos = 0;

				var i = 1;
				for (var sub in satistacao) {
					totalPontos += (satistacao[sub] * i);
					totalVotos += satistacao[sub];
					i++;
				}

				var posicao = Math.round(totalPontos / totalVotos);

				var divResultadoEntregueCliente = $('<div class="status '+classes[posicao]+'">').appendTo(divCliente);
				divResultadoEntregueCliente.append('Resultado Entregue');
			}

			if (objeto.satisfacaoCliente.andamentoDoSprint != null) {

				var satistacao = objeto.satisfacaoCliente.andamentoDoSprint;

				var totalPontos = 0;
				var totalVotos = 0;

				var i = 1;
				for (var sub in satistacao) {
					totalPontos += (satistacao[sub] * i);
					totalVotos += satistacao[sub];
					i++;
				}

				var posicao = Math.round(totalPontos / totalVotos);

				var divAndamentoDoSprintCliente = $('<div class="status '+classes[posicao]+'">').appendTo(divCliente);
				divAndamentoDoSprintCliente.append('Andamento do Sprint');
			}

		}

		return novoProjeto;
}

	$.get('dados/projetos', function(projetos) {
		var divProjetos = $('div#projetos').empty();

		for (var i = 0; i < projetos.length; ++i) {
			divProjetos.append(tabularObjeto(projetos[i]));
		}
	});

</script>

</html>
