<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>DexBoard Reload</title>
	<script type="text/javascript" src="js/lib/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src="js/lib/handlebars-v4.0.5.js"></script>
	<link rel="stylesheet" type="text/css" href="css/dx-board.css"/>
</head>
<body>
	<div id="tabela-principal" class="dx-table dx-table-flip"></div>
	
	<script type="text/x-handlebars-template" id="dexboard-template">
		<table>
			<tbody>
				<tr>
					<th class="logo"><img src="img/header-logo.png" alt="dxb - DexBoard"></th>
					{{#each indicadores}}
					<th>{{nome}}</th>
					{{/each}}
				</tr>
				{{#each projetos}}
				<tr>
					<td class="{{lowerCase classificacao}}{{#if atrasado}} atrasado{{/if}}">
						<div class="vertical">{{nome}}</div>
					</td>
					{{#each indicadores}}
					<td class="{{lowerCase classificacao}}{{#if atrasado}} atrasado{{/if}}">{{#if @first}}{{../cpi}}{{/if}}</td>
					{{/each}}
				</tr>
				{{/each}}
			</tbody>
		</table>
	</script>
	
	<script type="text/javascript">
		var templateSource = $("#dexboard-template").html();
		var container = $("#tabela-principal");
		var template = Handlebars.compile(templateSource);
		
		Handlebars.registerHelper("lowerCase", function(str) {
			return str.toLowerCase();
		});
		
		$.getJSON("/query", function(projetos) {
			if (projetos && projetos.length > 0) {
				
				var indicadores = projetos[0].indicadores;
				
				container.html(template({
					"projetos" : projetos,
					"indicadores" : indicadores
				}));
			}
		});
	</script>
	
</body>
</html>

